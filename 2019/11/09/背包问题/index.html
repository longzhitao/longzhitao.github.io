<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="LongZhitao">


    <meta name="subtitle" content="Karma.">




<title>背包问题 | Lynn</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">LongZhitao&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">LongZhitao&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">背包问题</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">LongZhitao</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十一月 9, 2019&nbsp;&nbsp;9:27:42</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="0-1背包问题"><a href="#0-1背包问题" class="headerlink" title="0-1背包问题"></a>0-1背包问题</h1><p>给定一组<strong>物品($n$)</strong>和一个背包，每种物品有各自的<strong>重量($w_i$)</strong>和<strong>价值($v_i$)</strong>，而背包的<strong>负重($c$)</strong>有限。在限定的总重量内，我们怎样选择物品，才能使得背包内物品的总价格最高。</p>
<p>在选择物品装入背包的时候，对每种<strong>物品 $i$</strong> 我们只有两种选择，<strong>装入背包</strong>或者<strong>不装入背包</strong>。并且<strong>不能</strong>将<strong>物品 $i$ 装入背包多次</strong>，也<strong>不能只装入部分的物品 $i$</strong> 。</p>
<h2 id="形式化描述"><a href="#形式化描述" class="headerlink" title="形式化描述"></a>形式化描述</h2><p>​        给定 $c&gt;0$， $\ w_i&gt;0$， $\ (1\le i \le n)$，使得$\sum_{i=1}^{n}w_i x_i\le c$, 而且$\sum_{i=1}^{n}v_ix_i$达到最大。</p>
<script type="math/tex; mode=display">
max\sum_{i=1}^{n} v_i x_i =\begin{cases}
\sum_{i=1}^{n} w_i x_i \leq c & \\
x_i \in \{0,1\} & 2 \leq i \leq n 
\end{cases}</script><h2 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h2><h3 id="蛮力破解"><a href="#蛮力破解" class="headerlink" title="蛮力破解"></a>蛮力破解</h3><p>枚举所有的情况，对于 $n$ 个物品，每个物品 $i$ 只有装入和不装入的情况，那么一共有 $2^n$ 种情况。对于每个情况，我们可以用二进制串来表示物品装入情况，<strong>0</strong>表示不放入，<strong>1</strong>表示放入。</p>
<p>例如有 $2$ 个物品，那么一共有 $2^2$ 种情况：$00$ $01$ $10$ $11$ 。$00$ 代表全部不放入，$01$ 代表只放入第二件物品，以此类推。对于每种情况，其中 $\sum_{str_i=1}^{n}w_i \le c$ 记为该种情况的和，否则不符合条件。对于符合条件的情况，与之前的最大值对比，如果比最大值大则更新最大值。</p>
<h4 id="函数代码"><a href="#函数代码" class="headerlink" title="函数代码"></a>函数代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">brute_force</span><span class="params">(<span class="keyword">int</span> w[], <span class="keyword">int</span> v[], <span class="keyword">int</span> n, <span class="keyword">int</span> C)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> max_value = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">pow</span>(<span class="number">2</span>, n); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> case_i = i;</span><br><span class="line">        <span class="keyword">int</span> case_i_weight = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> case_i_value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">bool</span> isBeyond = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (case_i &amp; <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                case_i_weight += w[j];</span><br><span class="line">                case_i_value += v[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (case_i_weight &gt; C)</span><br><span class="line">            &#123;</span><br><span class="line">                isBeyond = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            case_i = case_i &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (case_i_value &gt; max_value &amp;&amp; !isBeyond)</span><br><span class="line">            max_value = case_i_value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><p>对于 $n$ 个物品，共有 $2^n$ 种情况，每种情况平均需计算 $n$ 次，所以算法复杂度为：$O(n2^n)$</p>
<h3 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h3><p>贪心算法不能解决01背包问题，只能求出局部解，而且根据贪心策略不同，解的情况也不同。对于01背包问题，通常有以下几种贪心策略：</p>
<ol>
<li>每次选 $Min\ w_i$</li>
<li>每次选 $Max\ v_i$</li>
<li>每次选 $Max\ v_i/w_i$ </li>
</ol>
<p><strong>举例</strong></p>
<p>物品 $n$ 的输入表格如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">$n_1$</th>
<th style="text-align:center">$n_2$</th>
<th style="text-align:center">$n_3$</th>
<th style="text-align:center">$n_4$</th>
<th style="text-align:center">$n_5$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$w$</td>
<td style="text-align:center">20</td>
<td style="text-align:center">30</td>
<td style="text-align:center">40</td>
<td style="text-align:center">50</td>
<td style="text-align:center">60</td>
</tr>
<tr>
<td style="text-align:center">$v$</td>
<td style="text-align:center">20</td>
<td style="text-align:center">30</td>
<td style="text-align:center">30</td>
<td style="text-align:center">55</td>
<td style="text-align:center">60</td>
</tr>
<tr>
<td style="text-align:center">$v/w$</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
</div>
<p>不同贪心策略和最优解结果表格如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">$Strategy$</th>
<th style="text-align:center">$x_1$</th>
<th style="text-align:center">$x_2$</th>
<th style="text-align:center">$x_3$</th>
<th style="text-align:center">$x_4$</th>
<th style="text-align:center">$x_5$</th>
<th style="text-align:center">$\ sum_{i=1}^{n}w_i x_i$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$Min\ w_i$</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">94</td>
</tr>
<tr>
<td style="text-align:center">$Max\ v_i$</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">104</td>
</tr>
<tr>
<td style="text-align:center">$Max\ v_i/w_i$</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">99</td>
</tr>
<tr>
<td style="text-align:center">$Optimal$</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">105</td>
</tr>
</tbody>
</table>
</div>
<h4 id="函数代码-1"><a href="#函数代码-1" class="headerlink" title="函数代码"></a>函数代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> weight;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    <span class="keyword">float</span>  w_v_ratio;</span><br><span class="line">&#125;item[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">greedy</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> C)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> max_value = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> sum_value = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> sum_weight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    weight_sort();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum_weight + item[i].weight &lt; C)</span><br><span class="line">        &#123;</span><br><span class="line">            sum_weight += item[i].weight;</span><br><span class="line">            sum_value += item[i].value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    max_value = sum_value;</span><br><span class="line">    sum_value = <span class="number">0</span>;</span><br><span class="line">    sum_weight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    value_sort();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum_weight + item[i].weight &lt; C)</span><br><span class="line">        &#123;</span><br><span class="line">            sum_weight += item[i].weight;</span><br><span class="line">            sum_value += item[i].value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum_value &gt; max_value)</span><br><span class="line">        max_value = sum_value;</span><br><span class="line">    sum_value = <span class="number">0</span>;</span><br><span class="line">    sum_weight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    w_v_ration_sort();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum_weight + item[i].weight &lt; C)</span><br><span class="line">        &#123;</span><br><span class="line">            sum_weight += item[i].weight;</span><br><span class="line">            sum_value += item[i].value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum_value &gt; max_value)</span><br><span class="line">        max_value = sum_value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> max_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度"></a>复杂度</h4><p>将物品按照贪心策略排序，之后只需遍历一次物品直到拿走的物品超出容量 $C$ ，所以算法的平均复杂度为$O(n\log n + n) =$  $O(n\log n)$</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><p>我们可以定义子问题$F(i,\ W)$，表明将前 $i$ 个物品放入容量为 $C$ 的背包中，每种物品只能取一次，不能取物品的一部分，再定义其最优解为 $m(i,\ W)$，其中$1 \le W \le C,\ 1 \le i \le n$。</p>
<blockquote>
<p>考虑第 $i$ 个物品，我们以下两种选择</p>
<ol>
<li>放入，背包容量减少 $w_i$ ，问题转化为$F(i - 1,\ W - w_i)$</li>
<li>不放入，背包容量不变，问题转化为$F(i-1,\ W)$</li>
</ol>
</blockquote>
<p>而最优解是比较两种选择，取最好的方案：</p>
<blockquote>
<p>$m(i,\ W) = max\{m(i-1,W),\ m(i-1,W-w_i)+v_i\}$</p>
</blockquote>
<h4 id="递推公式"><a href="#递推公式" class="headerlink" title="递推公式"></a>递推公式</h4><script type="math/tex; mode=display">
m(i,j)=
\begin{cases}
0 & if\ \ i = 0\\
0 & if\ \ W = 0\\
m(i-1,W) & if\ \  w_i>W\\
max\{m(i+1,j),m(i+1,j-w_i)+v_i\} & Otherwise\\
\end{cases}</script><h4 id="函数代码-2"><a href="#函数代码-2" class="headerlink" title="函数代码"></a>函数代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dynamic_programming</span><span class="params">(<span class="keyword">int</span> w[], <span class="keyword">int</span> v[], <span class="keyword">int</span> n, <span class="keyword">int</span> C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dp[n + <span class="number">1</span>][C + <span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n + <span class="number">1</span>; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; C + <span class="number">1</span>; ++j) </span><br><span class="line">            dp[i][j] = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= C; ++j) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &lt; w[i])</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - w[i]] + v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n][C];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="复杂度-2"><a href="#复杂度-2" class="headerlink" title="复杂度"></a>复杂度</h4><p>由递推公式可知算法时间和空间复杂度均$O(nC)$为，算法复杂度主要与背包的容量$C$有关。</p>
<h3 id="遗传算法"><a href="#遗传算法" class="headerlink" title="遗传算法"></a>遗传算法</h3><p>遗传算法中，每条染色体是由<strong>二进制串</strong>组成，染色体中<strong>不同的二进制串代表着不同的基因型</strong>，而<strong>二进制串所代表的含义称之为表现型</strong>。类似与蛮力破解中的定义，我们假定每个<strong>染色体由一个长度为$n$的基因组成</strong>。<strong>对于基因中第个$i$位置的因子，$1$代表将物品放入背包，$0$则反之</strong>。对于的计算，我们<strong>选择$\sum_{i=1}^{n} w_i x_i $作为适应度函数的值，且$\sum_{i=1}^{n} w_i x_i \le C$，否则$Fitness$为$0$。</strong>我们设定基因<strong>变异的概率为0.2</strong>，<strong>交叉的概率为0.3</strong>，<strong>种群个数为30</strong>，<strong>最大生成代数(程序终止条件)为1000</strong>。这四个设定可以根据问题规模自行修改。</p>
<h4 id="形式化描述-1"><a href="#形式化描述-1" class="headerlink" title="形式化描述"></a>形式化描述</h4><script type="math/tex; mode=display">
\begin{aligned}
Chromosome &\in String\\
Chromosome &= \sum_{i=1}^{n}x_i \ \ \ x \in\{0,1\} \ \\
Chromosome\ length &= n \\
Mutation\ rate &= 0.2\\
Recombination\ rate &= 0.3\\
Population &=30 \\
Fitness &=  
\begin{cases}
0 & if\ \sum_{i=1}^{n} w_i x_i > c \\
\sum_{i=1}^{n} v_i x_i & Otherwise
\end{cases}
\end{aligned}</script><h4 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h4><p><img src="/2019/11/09/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/Knapsack_problem_ga_flow_chart.png" alt="背包问题遗传算法流程图"></p>
<h4 id="函数代码-3"><a href="#函数代码-3" class="headerlink" title="函数代码"></a>函数代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random <span class="keyword">as</span> rd</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GA</span><span class="params">(object)</span>:</span></span><br><span class="line">    weight = list()</span><br><span class="line">    value = list()</span><br><span class="line">    C = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, population, gene_length, mutation_rate, recombination_rate, c)</span>:</span></span><br><span class="line">        self.population = population</span><br><span class="line">        self.gene_length = gene_length</span><br><span class="line">        self.C = c</span><br><span class="line"></span><br><span class="line">        self.mutation_rate = mutation_rate</span><br><span class="line">        self.recombination_rate = recombination_rate</span><br><span class="line"></span><br><span class="line">        self.gene_list = list()</span><br><span class="line">        self.gene_fitness_var = list()</span><br><span class="line"></span><br><span class="line">        self.best_gene = <span class="literal">None</span></span><br><span class="line">        self.best_gene_fitness_var = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.gene_list.clear()</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.population):</span><br><span class="line">                gene = list()</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(self.gene_length):</span><br><span class="line">                    rand = rd.random()</span><br><span class="line">                    <span class="keyword">if</span> rand &gt;= <span class="number">0.8</span>:</span><br><span class="line">                        gene.append(<span class="string">'1'</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        gene.append(<span class="string">'0'</span>)</span><br><span class="line">                self.gene_list.append(gene)</span><br><span class="line">            self.fitness_func()</span><br><span class="line">            <span class="keyword">if</span> self.best_gene_fitness_var &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fitness_func</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.gene_fitness_var.clear()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.population):</span><br><span class="line">            fitness_var = <span class="number">0</span></span><br><span class="line">            total_weight = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.gene_length):</span><br><span class="line">                <span class="keyword">if</span> self.gene_list[i][j] == <span class="string">'1'</span>:</span><br><span class="line">                    fitness_var += int(self.value[j])</span><br><span class="line">                    total_weight += int(self.weight[j])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> total_weight &gt; self.C:</span><br><span class="line">                    fitness_var = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> fitness_var &gt; self.best_gene_fitness_var:</span><br><span class="line">                self.best_gene = self.gene_list[i]</span><br><span class="line">                self.best_gene_fitness_var = fitness_var</span><br><span class="line"></span><br><span class="line">            self.gene_fitness_var.append(fitness_var)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">roulette_wheel_selection</span><span class="params">(self)</span>:</span></span><br><span class="line">        sum_fitness_var = sum(self.gene_fitness_var)</span><br><span class="line">        total_probability = <span class="number">0</span></span><br><span class="line">        rand = rd.random()</span><br><span class="line">        select_index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.population):</span><br><span class="line">            total_probability = total_probability + self.gene_fitness_var[i] / sum_fitness_var</span><br><span class="line">            <span class="keyword">if</span> total_probability &gt;= rand:</span><br><span class="line">                select_index = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> select_index</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">operation_selection</span><span class="params">(probability)</span>:</span></span><br><span class="line">        rand = rd.random()</span><br><span class="line">        <span class="keyword">if</span> rand &lt;= probability:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">evolution</span><span class="params">(self)</span>:</span></span><br><span class="line">        select_index = self.roulette_wheel_selection()</span><br><span class="line">        gene_copy = copy.deepcopy(self.gene_list[select_index])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># mutation</span></span><br><span class="line">        <span class="keyword">if</span> self.operation_selection(self.mutation_rate):</span><br><span class="line">            mutation_pos = rd.randint(<span class="number">0</span>, self.gene_length - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> gene_copy[mutation_pos] == <span class="string">'1'</span>:</span><br><span class="line">                gene_copy[mutation_pos] = <span class="string">'0'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gene_copy[mutation_pos] = <span class="string">'1'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># recombination</span></span><br><span class="line">        <span class="keyword">if</span> self.operation_selection(self.recombination_rate):</span><br><span class="line">            first_pos = rd.randint(<span class="number">0</span>, self.gene_length - <span class="number">1</span>)</span><br><span class="line">            last_pos = rd.randint(first_pos, self.gene_length)</span><br><span class="line">            another_gene = self.gene_list[self.roulette_wheel_selection()]</span><br><span class="line">            gene_copy[first_pos: last_pos] = another_gene[first_pos: last_pos]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> gene_copy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_offspring</span><span class="params">(self)</span>:</span></span><br><span class="line">        offspring = list()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.population - <span class="number">1</span>):</span><br><span class="line">            offspring.append(self.evolution())</span><br><span class="line">        offspring.append(copy.deepcopy(self.best_gene))</span><br><span class="line">        self.gene_list = offspring</span><br><span class="line">        self.fitness_func()</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.population):</span><br><span class="line">            print(<span class="string">''</span>.join(self.gene_list[i]), end=<span class="string">' '</span>)</span><br><span class="line">            print(<span class="string">'value: '</span> + str(self.gene_fitness_var[i]))</span><br><span class="line">        print(<span class="string">'---------------------------------------------'</span>)</span><br><span class="line">        print(<span class="string">'Best Gene:'</span>)</span><br><span class="line">        print(<span class="string">''</span>.join(self.best_gene), end=<span class="string">' '</span>)</span><br><span class="line">        print(<span class="string">'value: '</span> + str(self.best_gene_fitness_var))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, max_generation)</span>:</span></span><br><span class="line">        generation = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(max_generation):</span><br><span class="line">            print(<span class="string">'No. '</span> + str(generation + i) + <span class="string">' generation'</span>)</span><br><span class="line">            self.display()</span><br><span class="line"></span><br><span class="line">            self.generate_offspring()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.best_gene_fitness_var == <span class="number">1063</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    wb = xlrd.open_workbook(filename=<span class="string">'0-1背包问题测试数据（提供参考）.xls'</span>)</span><br><span class="line">    sheet1 = wb.sheet_by_index(<span class="number">0</span>)</span><br><span class="line">    list1 = sheet1.col_values(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">    weight = list()</span><br><span class="line">    value = list()</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">        split_list = list1[k].split(<span class="string">' '</span>)</span><br><span class="line">        weight.append(split_list[<span class="number">0</span>])</span><br><span class="line">        value.append(split_list[<span class="number">1</span>])</span><br><span class="line">    GA.weight = weight</span><br><span class="line">    GA.value = value</span><br><span class="line"></span><br><span class="line">    ga = GA(<span class="number">100</span>, <span class="number">50</span>, <span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">300</span>)</span><br><span class="line">    ga.run(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h4 id="复杂度-3"><a href="#复杂度-3" class="headerlink" title="复杂度"></a>复杂度</h4><p>由于遗传算法为启发式算法,在大多数情况下只能为01背包问题找到近似最优解,所以我们只考虑算法生成一代种群的复杂度,以及在01背包问题下找出近似最优解的复杂度。</p>
<p>对于每一代种群生成的时间需要花费,染色体长度 $Length$乘以种群个数$Population$的时间,最后还需计算每个染色体的$Fitness$值,每次计算需要花费同生成一代种群的时间,即算法复杂度为$O(Length\ Population)$。</p>
<p>最后还需生成$MaxGenaration$代，所以总的复杂度为</p>
<p>$O(Length\ Population\ MaxGenaration)$</p>
<p>花费时间长短与解决问题的不同的遗传算法函数配置有关。</p>
<h2 id="算法对比"><a href="#算法对比" class="headerlink" title="算法对比"></a>算法对比</h2><p>遗传算法是启发式算法,耗费的时间是非确定性的,对结果只能求出近似最优O解,01背包问题是$NPC$问题,没有确定性多项式时间的解,而动态规划是伪确定性多项式时间的算法,两者不能直接比较,但是在不同的问题规模下,两者可以进行比较。</p>
<ol>
<li>当$C$足够大，大于$2^n$,动态规划的时间复杂度为$O(n2^n)$，得到最优解需要耗费大量的时间。此时遗传算法复杂度不变,能在配置输入的复杂度情况下得到近似最优解。所以当01背包问题规模庞大的时候优先使用遗传算法或是其他启发式算法。  </li>
<li>当01背包问题规模小的时候,动态规划的时间花费的时间比遗传算法的时间少,且能得出最优解,而遗传算法或者是其他启发式算法只能得到近似最优解,此时优先选择使用动态规划。 </li>
</ol>
<h2 id="算法测试"><a href="#算法测试" class="headerlink" title="算法测试"></a>算法测试</h2><h3 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h3><p> <a href="\download\0-1Knapsack_problem_data.xls">0-1Knapsack problem data.xls</a> </p>
<p>我们使用上述文件中的第一组数据。</p>
<h3 id="动态规划-1"><a href="#动态规划-1" class="headerlink" title="动态规划"></a>动态规划</h3><h4 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h4><p><img src="/2019/11/09/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/Knapsack_problem_dp_res.png" alt="背包问题_dp_输出结果"></p>
<h3 id="遗传算法-1"><a href="#遗传算法-1" class="headerlink" title="遗传算法"></a>遗传算法</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><script type="math/tex; mode=display">
\begin{aligned}

Mutation\ rate &= 0.2\\
Recombination\ rate &= 0.3\\
Population &=30 \\
Max\ genaration &=1000
\end{aligned}</script><h4 id="输出结果-1"><a href="#输出结果-1" class="headerlink" title="输出结果"></a>输出结果</h4><p><img src="/2019/11/09/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/Knapsack_problem_ga_res.png" alt="背包问题_ga_输出结果"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>LongZhitao</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://longzhitao.github.io/2019/11/09/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/">https://longzhitao.github.io/2019/11/09/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/DP/"># DP</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();" target="_blank" rel="noopener">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/11/23/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">编译原理学习笔记</a>
            
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© LongZhitao | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
